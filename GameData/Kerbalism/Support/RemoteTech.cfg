// Support for RemoteTech


// Kerbalism's Communotron 8
@PART[kerbalism-antenna]:NEEDS[RemoteTech]:FOR[Kerbalism]
{
	!MODULE[ModuleDataTransmitter] {}

	%MODULE[ModuleRTAntenna] {
		%Mode0OmniRange =			0
		%Mode1OmniRange = 1750000
		%EnergyCost = 0.125
		%MaxQ = 3000

		%TRANSMITTER
		{
			%PacketInterval = 0.3
			%PacketSize = 1
			%PacketResourceCost = 7.0
		}
	}

	%MODULE[ModuleSPUPassive] {}
}


@PART[RTShort*]:FOR[Kerbalism]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
	}
}

@PART[RTShort*]:NEEDS[FeatureReliability]:FOR[Kerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = true
		mtbf = 72576000 // 8y
		extra_cost = 1.2
		extra_mass = 0.1
	}	
}

@PART[RTLong*]:FOR[Kerbalism]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
	}
}

@PART[RTLong*]:NEEDS[FeatureReliability]:FOR[Kerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.5
		extra_mass = 0.4
	}	
}

@PART[RTGiga*]:FOR[Kerbalism]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
	}
}

@PART[RTGiga*]:NEEDS[FeatureReliability]:FOR[Kerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 3.2
		extra_mass = 0.5
	}	
}

// generic patches

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[PlannerController]:HAS[#title[transmitter]]]:NEEDS[RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
		considered = true
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[PlannerController]:HAS[#title[transmitter]]]:NEEDS[RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
		considered = true
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[>0]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.05
		extra_mass = 0.001
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[>0]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[zzzKerbalism]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.05
		extra_mass = 0.001
	}
}

// ============================================================================
// Reduce EC consumption
// ============================================================================
@PART[*]:HAS[@MODULE[ModuleRTAntenna]]:NEEDS[RemoteTech]:AFTER[zzzKerbalism]
{
	@MODULE[ModuleRTAntenna]:HAS[~DishAngle[],#Mode1OmniRange[>0]] // omni
	{
		@EnergyCost /= 1000
		@TRANSMITTER
		{
			@PacketResourceCost /= 1000
		}
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna]]:NEEDS[RemoteTech]:AFTER[zzzKerbalism]
{
	@MODULE[ModuleRTAntenna]:HAS[#DishAngle[>0],#Mode1DishRange[>0]] // dish
	{
		@EnergyCost /= 500
		@TRANSMITTER
		{
			@PacketResourceCost /= 500
		}
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive]]:NEEDS[RemoteTech]:AFTER[zzzKerbalism]
{
	@MODULE[ModuleRTAntennaPassive] // probe core internal antenna
	{
		@TRANSMITTER
		{
			@PacketResourceCost /= 1000
		}
	}
}
