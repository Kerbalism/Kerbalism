// Support for RemoteTech


// Kerbalism's Communotron 8
@PART[kerbalism-antenna]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	!MODULE[ModuleDataTransmitter],* {}
	!MODULE[ModuleDeployableAntenna],* {}
	!MODULE[Reliability],* {}

	%MODULE[ModuleAnimateGeneric]
	{
		%animationName = antenna
		%isOneShot = false
	   
		%startEventGUIName = Extend
		%endEventGUIName = Retract
		%actionGUIName = Toggle Antenna
		%allowManualControl = false
		%actionAvailable = false
		%eventAvailableFlight = false
		%eventAvailableEditor = false
		%eventAvailableEVA = false
	}

	%MODULE[ModuleRTAntenna] {
		%Mode0OmniRange = 0
		%Mode1OmniRange = 1750000
		%EnergyCost = 0.1
		%MaxQ = 3000

		%TRANSMITTER
		{
			%PacketInterval = 0.4
			%PacketSize = 1
			%PacketResourceCost = 5.0
		}
	}

	%MODULE[ModuleSPUPassive] {}
}

@PART[RTShort*]:NEEDS[FeatureReliability]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.2
		extra_mass = 0.1
	}	
}

@PART[RTLong*]:NEEDS[FeatureReliability]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.5
		extra_mass = 0.4
	}	
}

@PART[RTGiga*]:NEEDS[FeatureReliability]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 3.2
		extra_mass = 0.5
	}	
}

// generic patches

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[PlannerController]:HAS[#title[transmitter]]]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = PlannerController
		title = transmitter
		considered = true
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],!MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 1.0
		extra_mass = 0.1
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[<1]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],~CrewCapacity[]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.5
		extra_mass = 0.01
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[>0]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.05
		extra_mass = 0.001
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive],!MODULE[Reliability]:HAS[#type[Antenna]],@MODULE[ModuleCommand],#CrewCapacity[>0]]:NEEDS[FeatureReliability,RemoteTech]:AFTER[RemoteTech]
{
	MODULE
	{
		name = Reliability
		type = Antenna
		title = Antenna
		redundancy = Communication
		repair = Engineer
		mtbf = 72576000 // 8y
		extra_cost = 0.05
		extra_mass = 0.001
	}
}

// ============================================================================
// Reduce EC consumption
// ============================================================================
@PART[*]:HAS[@MODULE[ModuleRTAntenna]]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	@MODULE[ModuleRTAntenna]:HAS[~DishAngle[],#Mode1OmniRange[>0]] // omni
	{
		@EnergyCost /= 100
		@TRANSMITTER
		{
			@PacketResourceCost /= 1000
		}
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntenna]]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	@MODULE[ModuleRTAntenna]:HAS[#DishAngle[>0],#Mode1DishRange[>0]] // dish
	{
		@EnergyCost /= 50
		@TRANSMITTER
		{
			@PacketResourceCost /= 500
		}
	}
}

@PART[*]:HAS[@MODULE[ModuleRTAntennaPassive]]:NEEDS[RemoteTech]:AFTER[RemoteTech]
{
	@MODULE[ModuleRTAntennaPassive] // probe core internal antenna
	{
		@TRANSMITTER
		{
			@PacketResourceCost /= 1000
		}
	}
}
