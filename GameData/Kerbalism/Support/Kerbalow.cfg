// Kerbalow KA-330 Inflatable Space Hotel
// and
// Kerbal Expandable Activity Module

// ============================================================================
// Life Support
// ============================================================================
@PART[KA330exterior,KEAM]:NEEDS[Kerbalow,ProfileDefault]:AFTER[Kerbalism]
{
  MODULE
  {
    name = ProcessController
    resource = _Scrubber
    title = Scrubber
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _PressureControl
    title = Pressure control
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _AirPump
    title = Air Pump
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _HumidityController
    title = Humidity controller
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WaterRecycler
    title = Water recycler
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _WasteProcessor
    title = Waste processor
    capacity = #$/CrewCapacity$
    running = true
  }

  MODULE
  {
    name = ProcessController
    resource = _MonopropFuelCell
    title = Monoprop+O2 fuel cell
    capacity = #$/CrewCapacity$
    running = false
  }

  @MODULE[ProcessController],*
  {
    @capacity *= 1.67
  }

  MODULE
  {
    name = Configure
    title = Pod
    slots = 2

    UPGRADES
    {
      UPGRADE
      {
        name__ = Upgrade-Slots
        techRequired__ = electronics
        slots = 0
      }
    }

    SETUP
    {
      name = Scrubber
      desc = A dual-bed vacuum-exposing regenerative scrubber that sequesters <b>CarbonDioxide</b> from the internal atmosphere.
      mass = 0.01
      cost = 250

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _Scrubber
      }
    }

    SETUP
    {
      name = Pressure Control
      desc = Use <b>Nitrogen</b> to maintain the internal atmosphere at a comfortable pressure.
      tech = engineering101
      mass = 0.01
      cost = 250

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _PressureControl
      }

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _AirPump
      }

      RESOURCE
      {
        name = Nitrogen
        amount = #$/CrewCapacity$
        maxAmount = #$/CrewCapacity$
        @amount *= 500
        @maxAmount *= 500
      }
    }

    SETUP
    {
      name = Humidity Controller
      desc = Reclaims <b>Water</b> out of the internal atmosphere to maintain humidity.
      tech = survivability
      mass = 0.015
      cost = 300


      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _HumidityController
      }
    }

    SETUP
    {
      name = Water Recycler
      desc = Filter impurities out of <b>WasteWater</b>.
      tech = spaceExploration
      mass = 0.05
      cost = 500


      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _WaterRecycler
      }

      RESOURCE
      {
        name = WasteWater
        amount = 0
        maxAmount = #$/CrewCapacity$
        @maxAmount *= 5
      }
    }

    SETUP
    {
      name = Waste Processor
      desc = Extract <b>Ammonia</b> out of decomposing organic <b>Waste</b>.
      tech = advExploration
      mass = 0.05
      cost = 500

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _WasteProcessor
      }

      RESOURCE
      {
        name = Waste
        amount = 0
        maxAmount = #$/CrewCapacity$
        @maxAmount *= 5
      }
    }

    SETUP
    {
      name = Monoprop Oxygen Fuel Cell
      desc = An emergency fuel cell that burns <b>MonoPropellant</b> and <b>Oxygen</b> gas, producing <b>Water</b> and <b>Nitrogen</b> gas as by-products.
      tech = advElectrics
      mass = 0.1
      cost = 1000

      MODULE
      {
        type = ProcessController
        id_field = resource
        id_value = _MonopropFuelCell
      }
    }
  }
}

// ============================================================================
// Habitat (Inflatable)
// ============================================================================
@PART[KA330exterior]:NEEDS[Kerbalow,FeatureHabitat]:AFTER[Kerbalism]
{
  MODULE
  {
    name = Habitat
    inflate = Deploy
    state = disabled
    animBackwards = True
    volume = // 70 // need a number here: The values are deduced from bounding box if not specified - this can only be called when 3D model has not been rotated
    surface = // 40 // need a number here: The values are deduced from bounding box if not specified - this can only be called when 3D model has not been rotated
  }

  !MODULE[ModuleAnimateGeneric]:HAS[#animationName[Deploy]] {} // Functionality is replaced by ModuleHabitat
}

@PART[KEAM]:NEEDS[Kerbalow,FeatureHabitat]:AFTER[Kerbalism]
{
  MODULE
  {
    name = Habitat
    inflate = Inflate
    state = disabled
    animBackwards = True
    volume = // 12 // need a number here: The values are deduced from bounding box if not specified - this can only be called when 3D model has not been rotated
    surface = // 10 // need a number here: The values are deduced from bounding box if not specified - this can only be called when 3D model has not been rotated
  }

  !MODULE[ModuleAnimateGeneric]:HAS[#animationName[Inflate]] {} // Functionality is replaced by ModuleHabitat
}

// ============================================================================
// Comfort providers
// ============================================================================
@PART[KA330exterior]:NEEDS[Kerbalow,FeatureComfort]:AFTER[Kerbalism]
{
  MODULE:NEEDS[FeatureComfort]
  {
    name = Comfort
    desc = A treadmill designed to permit exercise in zero-g is included. The crew will love it.
    bonus = exercise
  }

  MODULE:NEEDS[FeatureReliability]
  {
    name = Reliability
    type = Comfort
    title = Treadmill
    repair = Engineer
    mtbf = 36288000 // 4y
    extra_cost = 0.25
    extra_mass = 0.05
  }
}
