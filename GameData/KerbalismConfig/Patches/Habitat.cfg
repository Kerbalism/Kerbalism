// ============================================================================
// Add habitat to all crewable parts
// ============================================================================

@PART[*]:HAS[!MODULE[ModuleKsmHabitat],#CrewCapacity[>0],!MODULE[KerbalSeat]]:NEEDS[KerbalismLifeSupport]:FOR[Kerbalism]
{
  MODULE
  {
    name = ModuleKsmHabitat
  }

  // add scrubbers to all habitats
  MODULE
  {
    name = ModuleKsmProcessController
    processName = scrubber
    id = scrubber
    capacity = #$/CrewCapacity$
    @capacity *= 1.6
    running = true
    uiGroup = #kerbalism-habitat
  }

  // Note : I hate those. Remove them and just always have the info in the telemetry UI.
  MODULE
  {
    name = Sensor
    type = temperature
  }
  MODULE
  {
    name = Sensor
    type = radiation
  }
  MODULE
  {
    name = Sensor
    type = habitat_radiation
  }
}


// ============================================================================
// Add pressure controller to command pots with >1 seats
// ============================================================================

@PART[*]:HAS[#CrewCapacity[>1],@MODULE[ModuleCommand]]:NEEDS[KerbalismLifeSupport]:FOR[Kerbalism]
{
  asdfasdf = yes
  MODULE
  {
    name = ModuleKsmProcessController
    processName = pressureControl
    id = pressureControl
    capacity = #$/CrewCapacity$
    @capacity *= 2
    running = true
    uiGroup = #kerbalism-habitat
  }
}


// ============================================================================
// Increase all crewable parts' EC because ECLSS uses EC constantly,
// you wanna survive in the Apollo LM, right?
// ============================================================================

@PART[*]:HAS[#CrewCapacity[>0],@RESOURCE[ElectricCharge]]:AFTER[zzzKerbalism]
{
	@RESOURCE[ElectricCharge]
	{
		@amount *= 2.8
		@maxAmount *= 2.8
	}
}

// ============================================================================
// Ad-hoc volume/surface for stock habitats
// ============================================================================

@PART[mk1pod,mk1pod_v2]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@title ^= :(.)$:$0 (UNPRESSURIZED) :
	@description ^= :(.)$:$0\n\n<color=orange>Unpressurized.</color> Bring your own space suit. :

	@MODULE[ModuleKsmHabitat]
	{
		canPressurize = false
	}
}
@PART[Mark1Cockpit,Mark2Cockpit]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@title ^= :(.)$:$0 (UNPRESSURIZED) :
	@description ^= :(.)$:$0\n\n<color=orange>Unpressurized.</color> Bring your own space suit. :

	@MODULE[ModuleKsmHabitat]
	{
		volume = 1.5
		surface = 8.0
		canPressurize = false
	}
}
@PART[landerCabinSmall]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 2.10
		surface = 8.8
	}
}
@PART[Mark1-2Pod]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 4.09
		surface = 9.54
	}
}
@PART[mk2LanderCabin,mk2LanderCabin_v2]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 3.9
		surface = 14.5
	}
}
@PART[crewCabin]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @tags ^= :$: comfort:

	@MODULE[ModuleKsmHabitat]
	{
		volume = 9.2
		surface = 16.0
    comfort = exercice
	}
}
@PART[cupola]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @tags ^= :$: comfort:

	@MODULE[ModuleKsmHabitat]
	{
		volume = 4.1
		surface = 10.5
    comfort = panorama
	}
}
@PART[mk2Cockpit_Standard]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 3.5
		surface = 19.5
	}
}
@PART[mk2Cockpit_Inline]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 6.5
		surface = 18.0
	}
}
@PART[mk3Cockpit_Shuttle]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 22.0
		surface = 40.2
	}
}
@PART[Large_Crewed_Lab]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 17.5
		surface = 28.0
	}
}
@PART[mk3CrewCabin]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 38.0
		surface = 44.0
	}
}

// ============================================================================
// Ad-hoc volume/surface for stock making history DLC
// ============================================================================

@PART[kv1Pod]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 2.8
		surface = 7.4
	}
}
@PART[kv2Pod]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 2.8
		surface = 7.4
	}
}
@PART[kv3Pod]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 2.8
		surface = 7.4
	}
}
@PART[Mk2Pod]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 2.2
		surface = 5.0
	}
}
@PART[MEMLander]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
	@MODULE[ModuleKsmHabitat]
	{
		volume = 2.4
		surface = 10.0
	}
}

@PART[InflatableAirlock]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @CrewCapacity = 1

  !MODULE[ModuleAnimateGeneric] {}
  //!MODULE[ModuleDockingNode] {} // note : we will to support / hack into deployable docking nodes...

	MODULE
	{
    name = ModuleKsmHabitat
		deployAnim = AirlockDeploy
	}
}
// ============================================================================
// Ad-hoc volume/surface for Kerbalism habitats
// ============================================================================

@PART[kerbalism-gravityring]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  %CrewCapacity = 6
  @mass = 3.5

	@MODULE[ModuleKsmHabitat]
	{
    deployAnim = open
    rotateAnim = rotate
		volume = 65.0
		surface = 95.0
	}
}

// ============================================================================
// TEMPORARY FOR TESTING
// ============================================================================

+PART[kerbalism-gravityring]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @name = gravityring-nopressure-animation
  @title = gravityring-nopressure-animation
  @category = Utility

	@MODULE[ModuleKsmHabitat]
	{
    deployAnim = open
    rotateAnim = rotate
		volume = 65.0
		surface = 95.0
	}
}

+PART[kerbalism-gravityring]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @name = gravityring-nopressure-transform
  @title = gravityring-nopressure-transform
  @category = Utility

	@MODULE[ModuleKsmHabitat]
	{
    deployAnim = open
    rotateAnim = main_body
    rotateIsTransform = true
    rotateAxis = 0,-1,0
		volume = 65.0
		surface = 95.0
	}
}

+PART[kerbalism-gravityring]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @name = gravityring-pressure-animation
  @title = gravityring-pressure-animation
  @category = Utility

	@MODULE[ModuleKsmHabitat]
	{
    deployAnim = open
    rotateAnim = rotate
    deployWithPressure = true
		volume = 65.0
		surface = 95.0
	}
}

+PART[kerbalism-gravityring]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @name = gravityring-pressure-transform
  @title = gravityring-pressure-transform
  @category = Utility

	@MODULE[ModuleKsmHabitat]
	{
    deployAnim = open
    rotateAnim = main_body
    rotateIsTransform = true
    rotateAxis = 0,-1,0
    deployWithPressure = true
		volume = 65.0
		surface = 95.0
	}
}

// ============================================================================
// END TEMPORARY FOR TESTING
// ============================================================================

// note : we might need a "canEnable" bool for parts that can be pressurized but should
// not count as living space / or be crewed, like the greenhouse
@PART[kerbalism-greenhouse]:NEEDS[KerbalismLifeSupport]:AFTER[Kerbalism]
{
  @tags ^= :$: comfort:

	%MODULE[ModuleKsmHabitat]
	{
		%volume = 18.0
		%surface = 31.0
    %comfort = plants
	}
}

// ============================================================================
// Add scrubber process to EVA kerbals
// ============================================================================

@PART[kerbalEVA*]:HAS[@MODULE[ModuleTripLogger]]:FOR[Kerbalism]
{
  MODULE
  {
    name = ModuleKsmProcessController
    processName = nonRegenerativeScrubber
    id = nonRegenerativeScrubber
    capacity = 1.0
    running = true
  }
}
