// ============================================================================
// Make stock panel module work in the background and at high timewarp speeds
// ============================================================================

@PART[*]:HAS[@MODULE[ModuleDeployableSolarPanel]]:FOR[Kerbalism]
{
  // duplicate every ModuleDeployableSolarPanel
  // Some parts may use multiple MDSP modules,
  // so we have to add a SolarPanelFixer module each of them
  +MODULE[ModuleDeployableSolarPanel],*
  {
    // delete all values
    -* = delete
    // delete all possible nodes
    -powerCurve {}
    -temperatureEfficCurve {}
    -timeEfficCurve {}
    -UPGRADES {}
    // rename the module to SolarPanelFixer
    name = SolarPanelFixer
  }
}

// ============================================================================
// Fuel cells
// ============================================================================

@PART[FuelCell]:FOR[Kerbalism]
{
  @TechRequired = basicScience
}

@PART[FuelCell,FuelCellArray]:FOR[Kerbalism]
{
  !MODULE[ModuleResourceConverter] {}
  !RESOURCE[ElectricCharge] {}

  MODULE
  {
    name = ModuleKsmProcessController
    id = fuelCell
    capacity = 1
  }

  MODULE
  {
    name = ModuleB9PartSwitch
    switcherDescription = #autoLOC_502022 // Fuel Cell
    moduleID = fuelCell
    affectDragCubes = false
    affectFARVoxels = false
  }
}

@PART[FuelCellArray]:FOR[Kerbalism]
{
  @MODULE[ModuleKsmProcessController]
  {
    @capacity = 6
  }
}

// add subtypes to all part switches with a moduleID that matches fuelCell*
// do this AFTER[Kerbalism] so that other support configs can add fuel cells
// to parts without having to re-define this list
@PART[*]:HAS[@MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelCell*]]]:AFTER[Kerbalism]
{
  @MODULE[ModuleB9PartSwitch]:HAS[#moduleID[fuelCell*]],*
  {
    SUBTYPE
		{
			name = fuelCell
			title = #KERBALISM_H2O2FuelCell_title
			descriptionSummary = #KERBALISM_H2O2FuelCell_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          id = #$../../../moduleID$
        }
        DATA {
          processName = #$../../name$
        }
      }
		}
    SUBTYPE
    {
      name = monopropFuelCell
      title = #KERBALISM_MonopropO2FuelCell_title
      descriptionSummary = #KERBALISM_MonopropO2FuelCell_desc
      MODULE
      {
        IDENTIFIER {
          name = ModuleKsmProcessController
          id = #$../../../moduleID$
        }
        DATA {
          processName = #$../../name$
        }
      }
    }
  }
}

// ============================================================================
// RTG
// ============================================================================

@PART[rtg]:FOR[Kerbalism]
{
  MODULE
  {
    name = ModuleKsmProcessController
    processName = radioisotopeGenerator
    capacity = 0.75
    running = true
  }

  !MODULE[ModuleGenerator] {}
  !MODULE[ModuleCoreHeat] {}
}

// ============================================================================
// Launch clamps
// ============================================================================

@PART[launchClamp1]:FOR[Kerbalism]
{
  MODULE
  {
    name = ModuleKsmProcessController
    processName = electricGenerator
    capacity = 1.0
    running = true
  }

  !MODULE[ModuleGenerator] {}
}
