// =============================================================================
// DING
// =============================================================================

@KERBALISM_EXPERIMENT_VALUES:NEEDS[KerbalismScience]
{
  ding
  {
    ECCost = 2.69
    size = 672862
    duration = 39916800
    value = 30
  }
}

EXPERIMENT_DEFINITION:NEEDS[KerbalismScience]
{
	id = kerbalism_DING
	title = #kerbalism-experiment-ding-title

  KERBALISM_EXPERIMENT
	{
    Situation = InSpaceHigh
    BodyNotAllowed = Suns
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[kerbalism_DING]]:NEEDS[KerbalismScience]:AFTER[Kerbalism]
{
  baseValue = #$@KERBALISM_EXPERIMENT_VALUES/ding/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/ding/size$
	@dataScale /= #$baseValue$
  scienceCap = #$baseValue$
}

@PART[kerbalism-experiment-ding]:NEEDS[KerbalismScience]:AFTER[Kerbalism]
{
  @MODULE[Experiment]
  {
    data_rate = #$@KERBALISM_EXPERIMENT_VALUES/ding/size$
    @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/ding/duration$
    ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/ding/ECCost$
  }
}

// =============================================================================
// BEEP
// =============================================================================

@KERBALISM_EXPERIMENT_VALUES:NEEDS[KerbalismScience]
{
  beep
  {
    ECCost = 1.92
    size = 4572
    duration = 14968800
    value = 33 // this takes >1y per biome, make it worth the effort
  }
}

EXPERIMENT_DEFINITION:NEEDS[KerbalismScience]
{
	id = kerbalism_BEEP
	title = #kerbalism-experiment-beep-title

  KERBALISM_EXPERIMENT
	{
    Situation = InSpaceLow@Biomes
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[kerbalism_BEEP]]:NEEDS[KerbalismScience]:AFTER[Kerbalism]
{
  baseValue = #$@KERBALISM_EXPERIMENT_VALUES/beep/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/beep/size$
	@dataScale /= #$baseValue$
  scienceCap = #$baseValue$
}

@PART[kerbalism-experiment-beep]:NEEDS[KerbalismScience]:AFTER[Kerbalism]
{
  @MODULE[Experiment]
  {
    data_rate = #$@KERBALISM_EXPERIMENT_VALUES/beep/size$
    @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/beep/duration$
    ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/beep/ECCost$
  }
}

// =============================================================================
// TICK
// =============================================================================

@KERBALISM_EXPERIMENT_VALUES:NEEDS[KerbalismScience]
{
  tick
  {
    ECCost = 0.82
    size = 3465789
    duration = 63763200
    value = 60
  }
}

EXPERIMENT_DEFINITION:NEEDS[KerbalismScience]
{
	id = kerbalism_TICK
	title = #kerbalism-experiment-tick-title

  KERBALISM_EXPERIMENT
	{
    Situation = InSpaceLow
    Situation = InSpaceHigh
    BodyAllowed = Suns
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[kerbalism_TICK]]:NEEDS[KerbalismScience]:AFTER[Kerbalism]
{
  baseValue = #$@KERBALISM_EXPERIMENT_VALUES/tick/value$
	dataScale = #$@KERBALISM_EXPERIMENT_VALUES/tick/size$
	@dataScale /= #$baseValue$
  scienceCap = #$baseValue$
}

@PART[kerbalism-experiment-tick]:NEEDS[KerbalismScience]:AFTER[Kerbalism]
{
  @MODULE[Experiment]
  {
    data_rate = #$@KERBALISM_EXPERIMENT_VALUES/tick/size$
    @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/tick/duration$
    ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/tick/ECCost$
  }
}

// =============================================================================
// Resource Scanner
// =============================================================================

@KERBALISM_EXPERIMENT_VALUES:NEEDS[KerbalismScience]
{
  ResourceScanner
  {
    ECCost = 0.5
    size = 2000
    value = 8
    duration = 432000
    requirements = OrbitMinInclination:80,OrbitMaxInclination:100,AltitudeBodyRadiusMin:3,AltitudeBodyRadiusMax:4
  }
}

EXPERIMENT_DEFINITION:NEEDS[KerbalismScience]
{
	id = KerbalismResourceScanner
	title = #kerbalism-experiment-resourceScanner-title

	KERBALISM_EXPERIMENT
	{
    	UnlockResourceSurvey = true
    	Situation = BodyGlobal
    	BodyNotAllowed = Suns
	}
}

@EXPERIMENT_DEFINITION:HAS[#id[KerbalismResourceScanner]]:NEEDS[KerbalismScience]:FOR[zzzKerbalism]
{
  baseValue = #$@KERBALISM_EXPERIMENT_VALUES/ResourceScanner/value$
  dataScale = #$@KERBALISM_EXPERIMENT_VALUES/ResourceScanner/size$
  @dataScale /= #$baseValue$
  scienceCap = #$baseValue$
}

// Replace the stock scanner module with our experiment that reproduces the feature
// Do it late (zzz) in case some MM patch is relying on that module being present (ScanSat?)
@PART[*]:HAS[@MODULE[ModuleOrbitalSurveyor]]:NEEDS[KerbalismScience]:FOR[zzzKerbalism]
{
  !MODULE[ModuleOrbitalSurveyor] {}

  MODULE
  {
    name = Experiment
    experiment_id = KerbalismResourceScanner
    experiment_desc = #kerbalism-experiment-resourceScanner-desc
    data_rate = #$@KERBALISM_EXPERIMENT_VALUES/ResourceScanner/size$
    @data_rate /= #$@KERBALISM_EXPERIMENT_VALUES/ResourceScanner/duration$
    ec_rate = #$@KERBALISM_EXPERIMENT_VALUES/ResourceScanner/ECCost$
    requires = #$@KERBALISM_EXPERIMENT_VALUES/ResourceScanner/requirements$
    allow_shrouded = false
    use_animation_group = true
  }
}
